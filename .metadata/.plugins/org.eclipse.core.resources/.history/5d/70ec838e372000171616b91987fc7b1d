package textExcel;

public class FormulaCell extends RealCell {
	private String formulaText;
	private Cell[][] userSpreadsheet;
	
	public FormulaCell (String specValue, Cell[][] spreadsheet) {
		super (specValue);
		formulaText = fullCellText().substring(2, fullCellText().length() -2);
		userSpreadsheet = spreadsheet;
	}
	
	public String abbreviatedCellText() {
		String formula = getDoubleValue() + "";
		if (formula.length() > 10) {
			return formula.substring(0, 10);   //truncates integer value longer than 9 characters and adds the percent sign
		} else if (formula.length() == 10) {	//no need to change the integer value since exactly 9 characters long
			return formula;
		} else {
			while (formula.length() < 10) {    //adds spaces so the cell will be 10 characters long if the integer value itself is shorter than 9 characters
				formula += " ";
			}
			return formula;
		}
	}			
			
	public double getDoubleValue() {
		String[] splitSpaces = formulaText.split(" ");
		double calculation = Double.parseDouble(splitSpaces[0]);
		for (int j = 0; j < splitSpaces.length; j+=2) {
			if (splitSpaces[j].toUpperCase().charAt(0) >= 65) {
				
				SpreadsheetLocation specLoc = new SpreadsheetLocation(splitSpaces[j]);
				double valueOfCell = userSpreadsheet[specLoc.getRow()][specLoc.getCol()].getDoubleValue();
				
			}
		}
		for (int i = 1; i < splitSpaces.length; i+=2) {
			if (splitSpaces[i].equals("+")) {
				calculation += Double.parseDouble(splitSpaces[i+1]);
			} else if (splitSpaces[i].equals("-")) {
				calculation -= Double.parseDouble(splitSpaces[i+1]);
			} else if (splitSpaces[i].equals("*")) {
				calculation *= Double.parseDouble(splitSpaces[i+1]);
			} else {
				calculation /= Double.parseDouble(splitSpaces[i+1]);
			}
		}
		return calculation;
		
	}
}
